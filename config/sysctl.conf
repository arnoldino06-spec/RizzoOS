# ===========================================
# RizzoOS - Kernel Hardening (sysctl.conf)
# ===========================================

# --- Protection réseau ---
# Ignorer les pings ICMP broadcast
net.ipv4.icmp_echo_ignore_broadcasts = 1

# Ignorer les réponses ICMP invalides
net.ipv4.icmp_ignore_bogus_error_responses = 1

# Activer la protection contre le SYN flood
net.ipv4.tcp_syncookies = 1

# Désactiver le routage IP (sauf si routeur)
net.ipv4.ip_forward = 0
net.ipv6.conf.all.forwarding = 0

# Ne pas accepter les redirections ICMP
net.ipv4.conf.all.accept_redirects = 0
net.ipv4.conf.default.accept_redirects = 0
net.ipv6.conf.all.accept_redirects = 0
net.ipv6.conf.default.accept_redirects = 0

# Ne pas envoyer de redirections ICMP
net.ipv4.conf.all.send_redirects = 0
net.ipv4.conf.default.send_redirects = 0

# Activer la validation des paquets source
net.ipv4.conf.all.rp_filter = 1
net.ipv4.conf.default.rp_filter = 1

# Ignorer les paquets source-routed
net.ipv4.conf.all.accept_source_route = 0
net.ipv4.conf.default.accept_source_route = 0
net.ipv6.conf.all.accept_source_route = 0
net.ipv6.conf.default.accept_source_route = 0

# Logging des paquets suspects
net.ipv4.conf.all.log_martians = 1
net.ipv4.conf.default.log_martians = 1

# --- Protection mémoire ---
# Randomisation de l'espace d'adressage (ASLR)
kernel.randomize_va_space = 2

# Restriction ptrace (anti-debugging malware)
kernel.yama.ptrace_scope = 1

# Protection contre les liens symboliques
fs.protected_symlinks = 1
fs.protected_hardlinks = 1

# Protection FIFOs et fichiers réguliers
fs.protected_fifos = 2
fs.protected_regular = 2

# --- Protection kernel ---
# Masquer les pointeurs kernel dans /proc
kernel.kptr_restrict = 2

# Restreindre l'accès à dmesg
kernel.dmesg_restrict = 1

# Désactiver SysRq (sauf pour sync et reboot sécurisé)
kernel.sysrq = 176

# Désactiver le chargement de modules non signés
# kernel.modules_disabled = 1  # Attention: empêche le chargement de nouveaux modules

# Performance BPF avec sécurité
kernel.unprivileged_bpf_disabled = 1
net.core.bpf_jit_harden = 2

# --- Performance réseau ---
# Augmenter la taille des buffers réseau
net.core.rmem_max = 16777216
net.core.wmem_max = 16777216
net.ipv4.tcp_rmem = 4096 87380 16777216
net.ipv4.tcp_wmem = 4096 65536 16777216

# Activer TCP Fast Open
net.ipv4.tcp_fastopen = 3

# Optimisation connexions
net.core.somaxconn = 65535
net.core.netdev_max_backlog = 65535

# --- Swap ---
# Réduire l'utilisation du swap (garder en RAM)
vm.swappiness = 10

# Pressure ratio pour le cache
vm.vfs_cache_pressure = 50
